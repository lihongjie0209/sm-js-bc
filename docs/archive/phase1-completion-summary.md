# ç¬¬ä¸€é˜¶æ®µå®Œæˆæ€»ç»“

## ä»£ç ä¼˜åŒ–ä¸æ¸…ç† - å·²å®Œæˆ âœ…

å®Œæˆæ—¶é—´ï¼š2025å¹´11æœˆ5æ—¥

### 1. GCM æ€§èƒ½ä¼˜åŒ– âœ…

**ä¼˜åŒ–å†…å®¹ï¼š**
- å°† `ciphertextBuffer` ä» `number[]` æ”¹ä¸º `Uint8Array`
- ä½¿ç”¨åŠ¨æ€å¢é•¿ç­–ç•¥ï¼Œé¿å…é¢‘ç¹çš„æ•°ç»„é‡æ–°åˆ†é…
- åˆå§‹åˆ†é…ç­–ç•¥ï¼šæŒ‰éœ€å¢é•¿ï¼Œæ¯æ¬¡æ‰©å®¹ç¿»å€ä»¥å‡å°‘åˆ†é…æ¬¡æ•°

**æ€§èƒ½æå‡ï¼š**
- å†…å­˜ä½¿ç”¨æ›´é«˜æ•ˆï¼ˆTyped Array vs æ™®é€šæ•°ç»„ï¼‰
- å‡å°‘åƒåœ¾å›æ”¶å‹åŠ›
- æ›´å¥½çš„ç¼“å­˜å±€éƒ¨æ€§

**ä»£ç å˜æ›´ï¼š**
```typescript
// ä¹‹å‰
private ciphertextBuffer: number[] = [];
// ç¼“å†²æ•°æ®
this.ciphertextBuffer.push(input[inOff + i]);

// ä¹‹å
private ciphertextBuffer: Uint8Array = new Uint8Array(0);
private ciphertextBufferLength: number = 0;
// åŠ¨æ€æ‰©å®¹å’Œæ‰¹é‡å¤åˆ¶
if (newLength > this.ciphertextBuffer.length) {
  const newBuffer = new Uint8Array(Math.max(newLength, this.ciphertextBuffer.length * 2));
  newBuffer.set(this.ciphertextBuffer.subarray(0, this.ciphertextBufferLength));
  this.ciphertextBuffer = newBuffer;
}
this.ciphertextBuffer.set(input.subarray(inOff, inOff + len), this.ciphertextBufferLength);
```

**æµ‹è¯•ç»“æœï¼š**
- âœ… æ‰€æœ‰ 614 ä¸ªæµ‹è¯•é€šè¿‡
- âœ… GCM æ‰€æœ‰ 17 ä¸ªæµ‹è¯•é€šè¿‡
- âœ… æ‰‹åŠ¨æµ‹è¯•éªŒè¯æˆåŠŸ

### 2. ä¸´æ—¶æµ‹è¯•æ–‡ä»¶æ•´ç† âœ…

**æ•´ç†å†…å®¹ï¼š**
- åˆ›å»º `scripts/manual-tests/` ç›®å½•
- ç§»åŠ¨æ‰€æœ‰ä¸´æ—¶æµ‹è¯•æ–‡ä»¶åˆ°è¯¥ç›®å½•ï¼š
  - `test-gcm-simple.mjs` - 16å­—èŠ‚ç®€å•æµ‹è¯•
  - `test-gcm-32bytes.mjs` - 32å­—èŠ‚å¤šå—æµ‹è¯•
  - `test-gcm-debug.mjs` - è°ƒè¯•è¾“å‡ºæµ‹è¯•
- ä¿®å¤å¯¼å…¥è·¯å¾„ï¼ˆä» `./dist/` æ”¹ä¸º `../../dist/`ï¼‰
- æ·»åŠ  README è¯´æ˜æ–‡æ¡£

**ç›®å½•ç»“æ„ï¼š**
```
scripts/
â””â”€â”€ manual-tests/
    â”œâ”€â”€ README.md
    â”œâ”€â”€ test-gcm-simple.mjs
    â”œâ”€â”€ test-gcm-32bytes.mjs
    â””â”€â”€ test-gcm-debug.mjs
```

### 3. ä»£ç æ¸…ç† âœ…

**æ¸…ç†å†…å®¹ï¼š**
- âœ… åˆ é™¤è°ƒè¯•æ³¨é‡Šï¼ˆæ— éœ€åˆ é™¤ï¼Œä»£ç å·²ç»å¾ˆå¹²å‡€ï¼‰
- âœ… ä¼˜åŒ–æ•°æ®ç»“æ„ï¼ˆä½¿ç”¨ Uint8Arrayï¼‰
- âœ… æ•´ç†é¡¹ç›®ç»“æ„ï¼ˆæ‰‹åŠ¨æµ‹è¯•ç‹¬ç«‹ç›®å½•ï¼‰

### æµ‹è¯•éªŒè¯ âœ…

**å•å…ƒæµ‹è¯•ï¼š**
```bash
npm test
# ç»“æœï¼š614/614 tests passed âœ…
```

**æ‰‹åŠ¨æµ‹è¯•ï¼š**
```bash
node scripts/manual-tests/test-gcm-32bytes.mjs
# ç»“æœï¼š32å­—èŠ‚åŠ å¯†/è§£å¯†æˆåŠŸï¼Œæ•°æ®åŒ¹é… âœ…
```

### æ€§èƒ½å¯¹æ¯”

**ä¼˜åŒ–å‰åå¯¹æ¯”ï¼š**

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| æ•°æ®ç»“æ„ | `number[]` | `Uint8Array` | âœ… |
| å†…å­˜æ•ˆç‡ | ä½ï¼ˆæ¯ä¸ªæ•°å­—8å­—èŠ‚ï¼‰ | é«˜ï¼ˆæ¯ä¸ªå­—èŠ‚1å­—èŠ‚ï¼‰ | 8x |
| ç¼“å­˜å‹å¥½æ€§ | å·® | å¥½ | âœ… |
| GC å‹åŠ› | é«˜ | ä½ | âœ… |

**å†…å­˜ä½¿ç”¨ä¼°ç®—ï¼š**
- 32å­—èŠ‚æ•°æ® + 16å­—èŠ‚MAC = 48å­—èŠ‚
- ä¼˜åŒ–å‰ï¼š`48 * 8 = 384` å­—èŠ‚ï¼ˆnumber[] åœ¨V8ä¸­æ¯ä¸ªå…ƒç´ 8å­—èŠ‚ï¼‰
- ä¼˜åŒ–åï¼š`48 * 1 = 48` å­—èŠ‚ï¼ˆUint8Arrayï¼‰
- **èŠ‚çœï¼š87.5%**

### ä¸‹ä¸€æ­¥è§„åˆ’

ç¬¬ä¸€é˜¶æ®µå·²å®Œæˆ âœ…ï¼Œå¯ä»¥ç»§ç»­ç¬¬äºŒé˜¶æ®µï¼š

**ç¬¬äºŒé˜¶æ®µï¼šæ–‡æ¡£å®Œå–„**
1. æ›´æ–° README æ·»åŠ  SM4 å®Œæ•´æ–‡æ¡£
2. åˆ›å»º SM4 å„æ¨¡å¼ä½¿ç”¨ç¤ºä¾‹
3. ç”Ÿæˆ API æ–‡æ¡£ï¼ˆTypeDocï¼‰
4. ç¼–å†™å®‰å…¨æœ€ä½³å®è·µæŒ‡å—

---

**æ€»ç»“ï¼š**

ç¬¬ä¸€é˜¶æ®µåœ†æ»¡å®Œæˆï¼ä¸»è¦æˆæœï¼š
- âœ… GCM æ€§èƒ½ä¼˜åŒ–ï¼ˆå†…å­˜æ•ˆç‡æå‡ 8xï¼‰
- âœ… ä»£ç æ•´æ´åº¦æå‡ï¼ˆä¸´æ—¶æ–‡ä»¶å½’æ¡£ï¼‰
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ614/614ï¼‰
- âœ… æ— åŠŸèƒ½å›å½’

å‡†å¤‡è¿›å…¥ç¬¬äºŒé˜¶æ®µï¼šæ–‡æ¡£å®Œå–„ ğŸ“š
